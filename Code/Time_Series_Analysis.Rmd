---
title: "Our Time Series Analysis"
author: "Shana Shapiro, Emma DeAngeli, and Ben Culberson"
date: "4/8/2022"
output: html_document
---

## Set up


```{r}
getwd()
library(tidyverse)
library(lubridate)
library(zoo)
library(trend)
library(ggplot2)
library(dplyr)

mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "right")
theme_set(mytheme)

```

## Wrangling

```{r, message = FALSE}

Forest_Share_Japan.data <- read.csv(file="../Data/Processed/Forest_Share_Japan.csv",
                   header=TRUE, stringsAsFactors = TRUE)
GEM.data <- read.csv(file="../Data/Processed/GEM_processed.csv",
                   header=TRUE, stringsAsFactors = TRUE)
GFD.data <- read.csv(file="../Data/Processed/GFD_processed.csv",
                   header=TRUE, stringsAsFactors = TRUE)


our.df <- cbind(Forest_Share_Japan.data, GEM.data, GFD.data)
our.df <- select(our.df, Share.of.Surface.Occupied.by.Forest, Country, Exports:credit.to.private)

our.df$Year <- lubridate::ymd(our.df$Year, truncated = 2L)

```


## Visualizing

```{r}
ggplot(our.df, aes(x = Year, y = Share.of.Surface.Occupied.by.Forest)) +
  geom_line() +
  geom_smooth( method = lm ) +
  labs(x = "", y = expression("Share of Surface Occupied by Forest"))

```

## Time Series Analysis

```{r}
forest_share.ts <- ts(our.df$Share.of.Surface.Occupied.by.Forest, start = c(2009,1), frequency = 1)
```

```{r}
# because there's no seasonality, I'm not sure we can use "stl" or "seasonal-trend-remainder"

forest_share.tsDecomposed <- stl(forest_share.ts, s.window = 7)
plot(forest_share.tsDecomposed)

```


monotonic trend analysis

```{r}
GaringerOzone.monthly_trend <- Kendall::SeasonalMannKendall(GaringerOzone.monthly.ts)
GaringerOzone.monthly_trend
summary(GaringerOzone.monthly_trend)

```

> Answer:  The seasonal Mann-Kendall is most appropriate because there is seasonality in the data and the data is non-parametric.

13. Create a plot depicting mean monthly ozone concentrations over time, with both a geom_point and a geom_line layer. Edit your axis labels accordingly.

```{r}
# 13
ourdata_plot <-
ggplot(our.df, aes(x = Year, y = MeanOzone)) +
  geom_point() +
  geom_line() +
  xlab("Year Month") +
  ylab("Average Ozone Concentration") +
  geom_smooth( method = lm )
print(GaringerOzone.monthly_plot)

```

14. To accompany your graph, summarize your results in context of the research question. Include output from the statistical test in parentheses at the end of your sentence. Feel free to use multiple sentences in your interpretation.


15. Subtract the seasonal component from the `GaringerOzone.monthly.ts`. Hint: Look at how we extracted the series components for the EnoDischarge on the lesson Rmd file.

16. Run the Mann Kendall test on the non-seasonal Ozone monthly series. Compare the results with the ones obtained with the Seasonal Mann Kendall on the complete series.

```{r}
#15
GaringerOzone.monthly.ts_Components <- GaringerOzone.monthly_Decomposed$time.series[,2:3]
plot(GaringerOzone.monthly.ts_Components)

#16
GaringerOzone.monthly_trend1 <- Kendall::MannKendall(GaringerOzone.monthly.ts_Components)
GaringerOzone.monthly_trend1

```